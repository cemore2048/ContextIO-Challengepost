<!doctype html>
<html>

<head>
	<title> </title>
	<script src="/d3.min.js" type="text/javascript"></script>
	<script src="/jquery-2.1.4.js"></script>


	<script>
	var data;

	function fetchAllMessages(start, increment, done){
		var messaes = [];
		(function nextCall(ofset){
			d3.json("/api/messages/" + offset, function(error, data){
				if(error) return done(error, messages);
				if(!data.messages) return done("unexpected response format", messages);

				messages.push.apply(messages, data.messages);
				if( data.messages.length === increment) {
					nextCall(offset + increment);
				} else {
					done(null, messages);
				}
			});
		});(start);
	}
	$(document).ready(function() {
			$('button').click(function() {
	        var start = Date.now();

	        fetchAllMessages(0, 100, function (err, messages) {
	            var end = Date.now();
	            if (err) console.warn(err);
	            console.log(messages);
	            console.log("Time to execute : " + (start - end));
	        });
	    });
	});


	</script>
</head>
<body>
		<button>Send an HTTP GET request to a page and get the result back</button>
</body>
<html>
