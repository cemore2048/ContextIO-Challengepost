<!doctype html>
<html ng-app="contextioChallenge">

<head>
	<title> </title>



	<script>
	var offset = 0;
	var maxOffset = 1000;
	var messagesUrl = "/api/messages";
	var contactsUrl = "/api/contacts";
	var start;
	var messagesResponse = [];
	var contactsResponse = [];

	var messagesCallback = function(json) {
		console.log("executing request...");
		messagesResponse.push(json);

		// if(json != null){
		// 	console.log("made it into null check");
		// 	for(var i = 0; i < json.length; i++){
		// 		console.log("count is : " + count);
		// 		count++;
		// 	}
		// }
		offset += 100;

		if(offset > maxOffset){
			var end = new Date().getTime();
			var time = end - start;
			console.log("Time to execute : "  + time/1000);
			//aqui vas a hacer la visualisacion

			return;
		}

		d3.json(messagesUrl + "/" + offset, messagesCallback);
	}

	var contactsCallback = function(json){
		contactsResponse.push(json);
		console.log("executing contacts");
		console.log(json);
		for( var i = 0; i < json.length; i++){
			console.log(json[i].name);
		}


		//jsonToHtmlTable(json, "#contacts")
		populateTable(json);
		return;

	}

	var listContacts = function(contactsJson){

	}
	$(document).ready(function(){
		$('#messages').click(function(){
			start = new Date().getTime();
			//d3.json is asynchronous. the program will get to this function
			//and immediately go to the next line while the function is still running
			//because of that. the visualization must be called within the callback
			d3.json(messagesUrl + "/" + offset, messagesCallback);
		});
		$('#contacts').click(function(){
			start = new Date().getTime();
			d3.json(contactsUrl + "/" + offset, contactsCallback);
		})
	});


	}

	</script>
</head>
<body ng-controller="indexController">
		<button>Send an HTTP GET request to a page and get the result back</button>
		<button id="contacts">Get contacts</button>
		<table id="contacts">
			<tr ng-repeat="x in contacts">
				<td>{{x.name}}</td>
				<td>{{x.count}}</td>
				<td>{{x.received}}</td>
				<td>{{x.sent}}</td>
			</tr>
		</table>

		<script src="/bower_components/d3/d3.min.js" type="text/javascript"></script>
		<script src="/bower_components/angular/angular.js"></script>
		<script src="/js/app.js"></script>
</body>
<html>
